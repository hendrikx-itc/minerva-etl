system
======



Tables
------

job
```



+---------------+--------------------------+---------------+
| Name          | Type                     |   Description |
+===============+==========================+===============+
| id            | integer                  |               |
+---------------+--------------------------+---------------+
| type          | character varying        |               |
+---------------+--------------------------+---------------+
| description   | character varying        |               |
+---------------+--------------------------+---------------+
| size          | bigint                   |               |
+---------------+--------------------------+---------------+
| created       | timestamp with time zone |               |
+---------------+--------------------------+---------------+
| started       | timestamp with time zone |               |
+---------------+--------------------------+---------------+
| finished      | timestamp with time zone |               |
+---------------+--------------------------+---------------+
| job_source_id | integer                  |               |
+---------------+--------------------------+---------------+
| state         | system.job_state_enum    |               |
+---------------+--------------------------+---------------+


job_error_log
`````````````



+---------+-------------------+---------------+
| Name    | Type              |   Description |
+=========+===================+===============+
| job_id  | integer           |               |
+---------+-------------------+---------------+
| message | character varying |               |
+---------+-------------------+---------------+


job_queue
`````````



+--------+---------+---------------+
| Name   | Type    |   Description |
+========+=========+===============+
| job_id | integer |               |
+--------+---------+---------------+


job_source
``````````



+----------+-----------------------+---------------+
| Name     | Type                  |   Description |
+==========+=======================+===============+
| id       | integer               |               |
+----------+-----------------------+---------------+
| name     | character varying(64) |               |
+----------+-----------------------+---------------+
| job_type | character varying(64) |               |
+----------+-----------------------+---------------+
| config   | character varying     |               |
+----------+-----------------------+---------------+


setting
```````



+--------+---------+---------------+
| Name   | Type    |   Description |
+========+=========+===============+
| id     | integer |               |
+--------+---------+---------------+
| name   | text    |               |
+--------+---------+---------------+
| value  | text    |               |
+--------+---------+---------------+

Functions
---------

+-------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------+---------------+
| Name                                                                                                  | Return Type                                                                         |   Description |
+=======================================================================================================+=====================================================================================+===============+
| add_job_source(character varying, character varying, character varying)                               | integer                                                                             |               |
+-------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------+---------------+
| add_setting(name text, value text)                                                                    | system.setting                                                                      |               |
+-------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------+---------------+
| create_job(type character varying, description character varying, size bigint, job_source_id integer) | integer                                                                             |               |
+-------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------+---------------+
| fail_job(job_id integer, message character varying)                                                   | void                                                                                |               |
+-------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------+---------------+
| fail_job(job_id integer)                                                                              | void                                                                                |               |
+-------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------+---------------+
| finish_job(job_id integer)                                                                            | void                                                                                |               |
+-------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------+---------------+
| get_job()                                                                                             | system.job_type                                                                     |               |
+-------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------+---------------+
| get_job_source(integer)                                                                               | TABLE(name character varying, job_type character varying, config character varying) |               |
+-------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------+---------------+
| get_setting(name text)                                                                                | system.setting                                                                      |               |
+-------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------+---------------+
| get_setting_value(name text, "default" text)                                                          | text                                                                                |               |
+-------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------+---------------+
| get_setting_value(name text)                                                                          | text                                                                                |               |
+-------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------+---------------+
| remove_jobs(before timestamp with time zone)                                                          | integer                                                                             |               |
+-------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------+---------------+
| set_setting(name text, value text)                                                                    | system.setting                                                                      |               |
+-------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------+---------------+
| update_setting(name text, value text)                                                                 | system.setting                                                                      |               |
+-------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------+---------------+
